(window.webpackJsonp=window.webpackJsonp||[]).push([[320],{674:function(t,s,e){"use strict";e.r(s);var a=e(42),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"sysexit"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sysexit"}},[t._v("#")]),t._v(" SYSEXIT")]),t._v(" "),e("h2",{attrs:{id:"fast-return-from-fast-system-call"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#fast-return-from-fast-system-call"}},[t._v("#")]),t._v(" Fast Return from Fast System Call")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("Opcode")]),t._v(" "),e("th",[t._v("Mnemonic")]),t._v(" "),e("th",[t._v("Description")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("0F 35")]),t._v(" "),e("td",[t._v("SYSEXIT Fast return to privilege level 3 user code.")]),t._v(" "),e("td")])])]),t._v(" "),e("h2",{attrs:{id:"description"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#description"}},[t._v("#")]),t._v(" Description")]),t._v(" "),e("p",[t._v("Executes a fast return to privilege level 3 user code. This instruction is a companion instruction to the SYSENTER instruction. The SYSEXIT instruction is optimized to provide the maximum performance for returns from system procedures executing at protections levels 0 to user procedures executing at protection level 3. This instruction must be executed from code executing at privilege level 0.")]),t._v(" "),e("p",[t._v("Prior to executing the SYSEXIT instruction, software must specify the privilege level 3 code segment and code entry point, and the privilege level 3 stack segment and stack pointer by writing values into the following MSR and general-purpose registers:")]),t._v(" "),e("blockquote",[e("ul",[e("li",[t._v("SYSENTER_CS_MSR\nContains the 32-bit segment selector for the privilege level 0 code segment in which the processor is currently executing. (This value is used to compute the segment selectors for the privilege level 3 code and stack segments.)")]),t._v(" "),e("li",[t._v("EDX\nContains the 32-bit offset into the privilege level 3 code segment to the first instruction to be executed in the user code.")]),t._v(" "),e("li",[t._v("ECX\nContains the 32-bit stack pointer for the privilege level 3 stack.\nThe SYSENTER_CS_MSR MSR can be read from and written to using the RDMSR and WRMSR instructions. The register address is listed in Table 4-3. This address is defined to remain fixed for future IA-32 processors.")])])]),t._v(" "),e("p",[t._v("When the SYSEXIT instruction is executed, the processor does the following:")]),t._v(" "),e("ul",[e("li",[t._v("Adds 16 to the value in SYSENTER_CS_MSR and loads the sum into the CS selector register.")]),t._v(" "),e("li",[t._v("Loads the instruction pointer from the EDX register into the EIP register.")]),t._v(" "),e("li",[t._v("Adds 24 to the value in SYSENTER_CS_MSR and loads the sum into the SS selector register.")]),t._v(" "),e("li",[t._v("Loads the stack pointer from the ECX register into the ESP register.")]),t._v(" "),e("li",[t._v("Switches to privilege level 3.")]),t._v(" "),e("li",[t._v("Begins executing the user code at the EIP address.")])]),t._v(" "),e("p",[t._v('See "SYSENTER-Fast System Call" for information about using the SYSENTER and SYSEXIT instructions as companion call and return instructions.')]),t._v(" "),e("p",[t._v("The SYSEXIT instruction always transfers program control to a protected-mode code segment with a DPL of 3. The instruction requires that the following conditions are met by the operating system:")]),t._v(" "),e("ul",[e("li",[t._v("The segment descriptor for the selected user code segment selects a flat, 32-bit code segment of up to 4 GBytes, with execute, read, accessed, and non-conforming permissions.")]),t._v(" "),e("li",[t._v("The segment descriptor for selected user stack segment selects a flat, 32-bit stack segment of up to 4 GBytes, with expand-up, read, write, and accessed permissions.")])]),t._v(" "),e("p",[t._v("The SYSENTER can be invoked from all operating modes except real-address mode.")]),t._v(" "),e("p",[t._v("The SYSENTER and SYSEXIT instructions were introduced into the IA-32 architecture in the Pentium II processor. The availability of these instructions on a processor is indicated with the SYSENTER/SYSEXIT present (SEP) feature flag returned to the EDX register by the CPUID instruction. An operating system that qualifies the SEP flag must also qualify the processor family and model to ensure that the SYSENTER/SYSEXIT instructions are actually present.")]),t._v(" "),e("p",[t._v("For example:")]),t._v(" "),e("p",[t._v("IF (CPUID SEP bit is set) THEN IF (Family = 6) AND (Model < 3) AND (Stepping < 3) THEN SYSENTER/SYSEXIT_Not_Supported FI; ELSE SYSENTER/SYSEXIT_Supported FI; When the CPUID instruction is executed on the Pentium Pro processor (model 1), the processor returns a the SEP flag as set, but does not support the SYSENTER/SYSEXIT instructions.")]),t._v(" "),e("h2",{attrs:{id:"operation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#operation"}},[t._v("#")]),t._v(" Operation")]),t._v(" "),e("div",{staticClass:"language-c line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-c"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("SYSENTER_CS_MSR "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Exception")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GP")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CR0"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PE "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Exception")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GP")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CPL "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Exception")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GP")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nCS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SEL "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" SYSENTER_CS_MSR "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Segment selector for return CS")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Set rest of CS to a fixed value")]),t._v("\nCS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BASE "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Flat segment")]),t._v("\nCS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LIMIT "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0xFFFF")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//4 GByte limit")]),t._v("\nCS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ARbyte"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("G "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//4 KByte granularity")]),t._v("\nCS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ARbyte"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("S "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nCS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ARbyte"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TYPE "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0xB")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Execute, Read, Non-Conforming Code")]),t._v("\nCS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ARbyte"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("D "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//32-bit code segment")]),t._v("\nCS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ARbyte"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DPL "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nCS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ARbyte"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RPL "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nCS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ARbyte"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("P "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nSS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SEL "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" SYSENTER_CS_MSR "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Segment selector for return SS")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Set rest of SS to a fixed value")]),t._v("\nSS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BASE "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Flat segment")]),t._v("\nSS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LIMIT "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0xFFFF")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//4 GByte limit")]),t._v("\nSS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ARbyte"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("G "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//4 KByte granularity")]),t._v("\nSS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ARbyte"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("S "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nSS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ARbyte"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TYPE "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Expand Up, Read/Write, Data")]),t._v("\nSS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ARbyte"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("D "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//32-bit stack segment")]),t._v("\nSS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ARbyte"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DPL "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nSS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ARbyte"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RPL "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nSS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ARbyte"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("P "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nESP "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ECX"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nEIP "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" EDX"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br"),e("span",{staticClass:"line-number"},[t._v("20")]),e("br"),e("span",{staticClass:"line-number"},[t._v("21")]),e("br"),e("span",{staticClass:"line-number"},[t._v("22")]),e("br"),e("span",{staticClass:"line-number"},[t._v("23")]),e("br"),e("span",{staticClass:"line-number"},[t._v("24")]),e("br"),e("span",{staticClass:"line-number"},[t._v("25")]),e("br"),e("span",{staticClass:"line-number"},[t._v("26")]),e("br"),e("span",{staticClass:"line-number"},[t._v("27")]),e("br"),e("span",{staticClass:"line-number"},[t._v("28")]),e("br")])]),e("h2",{attrs:{id:"flags-affected"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#flags-affected"}},[t._v("#")]),t._v(" Flags affected")]),t._v(" "),e("p",[t._v("None.")])])}),[],!1,null,null,null);s.default=n.exports}}]);